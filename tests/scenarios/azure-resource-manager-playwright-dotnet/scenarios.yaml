# Test scenarios for azure-resource-manager-playwright-dotnet skill evaluation
# Each scenario tests a specific usage pattern against acceptance criteria

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  # Create Playwright Workspace
  - name: create_playwright_workspace
    prompt: |
      Create a Microsoft Playwright Testing workspace in Azure using the 
      Azure.ResourceManager.Playwright SDK with regional affinity enabled.
    expected_patterns:
      - "ArmClient"
      - "DefaultAzureCredential"
      - "GetPlaywrightWorkspaces"
      - "PlaywrightWorkspaceData"
      - "PlaywrightRegionalAffinity"
      - "PlaywrightLocalAuth"
      - "CreateOrUpdateAsync"
      - "DataplaneUri"
    tags:
      - basic
      - workspace
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;
      using Azure.ResourceManager.Playwright.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscriptionId = Environment.GetEnvironmentVariable("AZURE_SUBSCRIPTION_ID");
      var subscription = armClient.GetSubscriptionResource(
          new ResourceIdentifier($"/subscriptions/{subscriptionId}"));

      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var workspaceData = new PlaywrightWorkspaceData(AzureLocation.WestUS3)
      {
          RegionalAffinity = PlaywrightRegionalAffinity.Enabled,
          LocalAuth = PlaywrightLocalAuth.Enabled,
          Tags =
          {
              ["Team"] = "Dev Exp",
              ["Environment"] = "Production"
          }
      };

      var workspaceCollection = resourceGroup.Value.GetPlaywrightWorkspaces();
      var operation = await workspaceCollection.CreateOrUpdateAsync(
          WaitUntil.Completed,
          "my-playwright-workspace",
          workspaceData);

      PlaywrightWorkspaceResource workspace = operation.Value;

      Console.WriteLine($"Data Plane URI: {workspace.Data.DataplaneUri}");
      Console.WriteLine($"Workspace ID: {workspace.Data.WorkspaceId}");

  # Get Workspace
  - name: get_workspace
    prompt: |
      Retrieve an existing Playwright Testing workspace and check if it exists.
    expected_patterns:
      - "GetAsync"
      - "ExistsAsync"
      - "DataplaneUri"
      - "ProvisioningState"
    tags:
      - get
      - existence
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var workspaceCollection = resourceGroup.Value.GetPlaywrightWorkspaces();

      // Check if exists first
      bool exists = await workspaceCollection.ExistsAsync("my-playwright-workspace");
      if (exists)
      {
          var workspace = await workspaceCollection.GetAsync("my-playwright-workspace");
          Console.WriteLine($"Workspace found: {workspace.Value.Data.Name}");
          Console.WriteLine($"  State: {workspace.Value.Data.ProvisioningState}");
          Console.WriteLine($"  Data Plane URI: {workspace.Value.Data.DataplaneUri}");
      }

  # Check Name Availability
  - name: check_name_availability
    prompt: |
      Check if a Playwright Testing workspace name is available before creating.
    expected_patterns:
      - "CheckPlaywrightNameAvailabilityAsync"
      - "PlaywrightCheckNameAvailabilityContent"
      - "IsNameAvailable"
      - "Message"
      - "Reason"
    tags:
      - name
      - validation
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;
      using Azure.ResourceManager.Playwright.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();

      var checkRequest = new PlaywrightCheckNameAvailabilityContent
      {
          Name = "my-new-workspace",
          ResourceType = "Microsoft.LoadTestService/playwrightWorkspaces"
      };

      var result = await subscription.CheckPlaywrightNameAvailabilityAsync(checkRequest);

      if (result.Value.IsNameAvailable == true)
      {
          Console.WriteLine("Name is available!");
      }
      else
      {
          Console.WriteLine($"Name unavailable: {result.Value.Message}");
          Console.WriteLine($"Reason: {result.Value.Reason}");
      }

  # List Workspaces
  - name: list_workspaces
    prompt: |
      List all Playwright Testing workspaces in a resource group and subscription.
    expected_patterns:
      - "GetPlaywrightWorkspaces"
      - "await foreach"
      - "GetAllAsync"
      - "GetPlaywrightWorkspacesAsync"
    tags:
      - list
      - management
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var workspaceCollection = resourceGroup.Value.GetPlaywrightWorkspaces();

      // List in resource group
      await foreach (var workspace in workspaceCollection.GetAllAsync())
      {
          Console.WriteLine($"Workspace: {workspace.Data.Name}");
          Console.WriteLine($"  Location: {workspace.Data.Location}");
          Console.WriteLine($"  State: {workspace.Data.ProvisioningState}");
          Console.WriteLine($"  Data Plane URI: {workspace.Data.DataplaneUri}");
      }

      // List across subscription
      await foreach (var workspace in subscription.GetPlaywrightWorkspacesAsync())
      {
          Console.WriteLine($"Workspace: {workspace.Data.Name}");
      }

  # Get Quota Information
  - name: get_quota
    prompt: |
      Get quota information for Playwright Testing workspaces at subscription and workspace level.
    expected_patterns:
      - "GetPlaywrightQuotasAsync"
      - "GetAllPlaywrightWorkspaceQuota"
      - "Limit"
      - "Used"
    tags:
      - quota
      - limits
    mock_response: |
      using Azure;
      using Azure.Core;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();

      // Subscription-level quotas
      await foreach (var quota in subscription.GetPlaywrightQuotasAsync(AzureLocation.WestUS3))
      {
          Console.WriteLine($"Quota: {quota.Data.Name}");
          Console.WriteLine($"  Limit: {quota.Data.Limit}");
          Console.WriteLine($"  Used: {quota.Data.Used}");
      }

      // Workspace-level quotas
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");
      var workspace = await resourceGroup.Value.GetPlaywrightWorkspaces().GetAsync("my-workspace");

      var workspaceQuotas = workspace.Value.GetAllPlaywrightWorkspaceQuota();
      await foreach (var quota in workspaceQuotas.GetAllAsync())
      {
          Console.WriteLine($"Workspace Quota: {quota.Data.Name}");
      }

  # Update Workspace
  - name: update_workspace
    prompt: |
      Update tags on a Playwright Testing workspace.
    expected_patterns:
      - "PlaywrightWorkspacePatch"
      - "UpdateAsync"
      - "Tags"
    tags:
      - update
      - tags
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;
      using Azure.ResourceManager.Playwright.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var workspace = await resourceGroup.Value.GetPlaywrightWorkspaces()
          .GetAsync("my-playwright-workspace");

      var patch = new PlaywrightWorkspacePatch
      {
          Tags =
          {
              ["Team"] = "Dev Exp",
              ["Environment"] = "Staging",
              ["UpdatedAt"] = DateTime.UtcNow.ToString("o")
          }
      };

      var updatedWorkspace = await workspace.Value.UpdateAsync(patch);
      Console.WriteLine($"Updated workspace: {updatedWorkspace.Value.Data.Name}");

  # Delete Workspace
  - name: delete_workspace
    prompt: |
      Delete a Playwright Testing workspace from Azure.
    expected_patterns:
      - "DeleteAsync"
      - "WaitUntil.Completed"
    tags:
      - delete
      - cleanup
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var workspace = await resourceGroup.Value.GetPlaywrightWorkspaces()
          .GetAsync("my-playwright-workspace");

      await workspace.Value.DeleteAsync(WaitUntil.Completed);
      Console.WriteLine("Workspace deleted");

  # Error Handling
  - name: error_handling
    prompt: |
      Implement proper error handling for Playwright Testing workspace operations.
    expected_patterns:
      - "RequestFailedException"
      - "ex.Status"
      - "catch"
      - "when"
    tags:
      - error-handling
      - best-practice
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Playwright;
      using Azure.ResourceManager.Playwright.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      try
      {
          var subscription = await armClient.GetDefaultSubscriptionAsync();
          var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

          var workspaceData = new PlaywrightWorkspaceData(AzureLocation.WestUS3)
          {
              RegionalAffinity = PlaywrightRegionalAffinity.Enabled,
              LocalAuth = PlaywrightLocalAuth.Enabled
          };

          var workspaceCollection = resourceGroup.Value.GetPlaywrightWorkspaces();
          var operation = await workspaceCollection.CreateOrUpdateAsync(
              WaitUntil.Completed, "my-workspace", workspaceData);
      }
      catch (RequestFailedException ex) when (ex.Status == 409)
      {
          Console.WriteLine("Workspace already exists");
      }
      catch (RequestFailedException ex) when (ex.Status == 400)
      {
          Console.WriteLine($"Bad request: {ex.Message}");
      }
      catch (RequestFailedException ex)
      {
          Console.WriteLine($"ARM Error: {ex.Status} - {ex.ErrorCode}: {ex.Message}");
      }
