# yaml-language-server: $schema=https://json.schemastore.org/any.json
# Test scenarios for azure-ai-formrecognizer-java skill evaluation

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  - name: client_creation
    prompt: |
      Create Java code to set up the Azure Document Intelligence (Form Recognizer)
      clients using DefaultAzureCredential. Create both DocumentAnalysisClient
      and DocumentModelAdministrationClient.
    expected_patterns:
      - "DocumentAnalysisClientBuilder"
      - "DocumentModelAdministrationClientBuilder"
      - "DefaultAzureCredentialBuilder"
      - "buildClient"
      - 'System\.getenv\('
    forbidden_patterns:
      - 'endpoint\("https://'
      - 'AzureKeyCredential\("'
    tags:
      - basic
      - authentication
    mock_response: |
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClient;
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClientBuilder;
      import com.azure.ai.formrecognizer.documentanalysis.administration.DocumentModelAdministrationClient;
      import com.azure.ai.formrecognizer.documentanalysis.administration.DocumentModelAdministrationClientBuilder;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ClientSetup {
          public static void main(String[] args) {
              String endpoint = System.getenv("FORM_RECOGNIZER_ENDPOINT");
              
              DocumentAnalysisClient analysisClient = new DocumentAnalysisClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              DocumentModelAdministrationClient adminClient = new DocumentModelAdministrationClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              System.out.println("Clients initialized successfully");
          }
      }

  - name: analyze_layout
    prompt: |
      Create a Java example that analyzes the layout of a PDF document,
      extracting pages, lines, and tables using the prebuilt-layout model.
    expected_patterns:
      - "beginAnalyzeDocument"
      - "prebuilt-layout"
      - "BinaryData"
      - "SyncPoller"
      - "getFinalResult"
      - "getPages"
      - "getTables"
    tags:
      - layout
      - analysis
    mock_response: |
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClient;
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClientBuilder;
      import com.azure.ai.formrecognizer.documentanalysis.models.*;
      import com.azure.core.util.BinaryData;
      import com.azure.core.util.polling.SyncPoller;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import java.io.File;

      public class LayoutAnalysis {
          public static void main(String[] args) {
              String endpoint = System.getenv("FORM_RECOGNIZER_ENDPOINT");
              
              DocumentAnalysisClient client = new DocumentAnalysisClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              File document = new File("document.pdf");
              BinaryData documentData = BinaryData.fromFile(document.toPath());
              
              SyncPoller<OperationResult, AnalyzeResult> poller = 
                  client.beginAnalyzeDocument("prebuilt-layout", documentData);
              
              AnalyzeResult result = poller.getFinalResult();
              
              for (DocumentPage page : result.getPages()) {
                  System.out.printf("Page %d: %.2f x %.2f%n",
                      page.getPageNumber(), page.getWidth(), page.getHeight());
                  
                  for (DocumentLine line : page.getLines()) {
                      System.out.println("Line: " + line.getContent());
                  }
              }
              
              for (DocumentTable table : result.getTables()) {
                  System.out.printf("Table: %d rows x %d columns%n",
                      table.getRowCount(), table.getColumnCount());
              }
          }
      }

  - name: analyze_invoice
    prompt: |
      Create a Java example that extracts invoice data from a URL
      using the prebuilt-invoice model. Extract merchant name and total.
    expected_patterns:
      - "beginAnalyzeDocumentFromUrl"
      - "prebuilt-invoice"
      - "getDocuments"
      - "getFields"
      - "DocumentField"
      - "getValueAsString"
    tags:
      - invoice
      - extraction
    mock_response: |
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClient;
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClientBuilder;
      import com.azure.ai.formrecognizer.documentanalysis.models.*;
      import com.azure.core.util.polling.SyncPoller;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import java.util.Map;

      public class InvoiceAnalysis {
          public static void main(String[] args) {
              String endpoint = System.getenv("FORM_RECOGNIZER_ENDPOINT");
              String invoiceUrl = System.getenv("INVOICE_URL");
              
              DocumentAnalysisClient client = new DocumentAnalysisClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              SyncPoller<OperationResult, AnalyzeResult> poller = 
                  client.beginAnalyzeDocumentFromUrl("prebuilt-invoice", invoiceUrl);
              
              AnalyzeResult result = poller.getFinalResult();
              
              for (AnalyzedDocument doc : result.getDocuments()) {
                  Map<String, DocumentField> fields = doc.getFields();
                  
                  DocumentField vendorName = fields.get("VendorName");
                  if (vendorName != null && vendorName.getType() == DocumentFieldType.STRING) {
                      System.out.printf("Vendor: %s (confidence: %.2f)%n",
                          vendorName.getValueAsString(),
                          vendorName.getConfidence());
                  }
                  
                  DocumentField total = fields.get("InvoiceTotal");
                  if (total != null && total.getType() == DocumentFieldType.CURRENCY) {
                      System.out.printf("Total: %s%n", total.getContent());
                  }
              }
          }
      }

  - name: build_custom_model
    prompt: |
      Create a Java example that builds a custom document model from
      training data in Azure Blob Storage.
    expected_patterns:
      - "DocumentModelAdministrationClient"
      - "beginBuildDocumentModel"
      - "DocumentModelBuildMode"
      - "BuildDocumentModelOptions"
      - "DocumentModelDetails"
      - "getModelId"
    tags:
      - custom-model
      - training
    mock_response: |
      import com.azure.ai.formrecognizer.documentanalysis.administration.DocumentModelAdministrationClient;
      import com.azure.ai.formrecognizer.documentanalysis.administration.DocumentModelAdministrationClientBuilder;
      import com.azure.ai.formrecognizer.documentanalysis.administration.models.*;
      import com.azure.ai.formrecognizer.documentanalysis.models.OperationResult;
      import com.azure.core.util.Context;
      import com.azure.core.util.polling.SyncPoller;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class CustomModelTraining {
          public static void main(String[] args) {
              String endpoint = System.getenv("FORM_RECOGNIZER_ENDPOINT");
              String blobContainerUrl = System.getenv("TRAINING_DATA_URL");
              
              DocumentModelAdministrationClient adminClient = new DocumentModelAdministrationClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              SyncPoller<OperationResult, DocumentModelDetails> poller = adminClient.beginBuildDocumentModel(
                  blobContainerUrl,
                  DocumentModelBuildMode.TEMPLATE,
                  null,
                  new BuildDocumentModelOptions()
                      .setModelId("my-custom-model")
                      .setDescription("Custom invoice model"),
                  Context.NONE);
              
              DocumentModelDetails model = poller.getFinalResult();
              
              System.out.println("Model ID: " + model.getModelId());
              System.out.println("Created: " + model.getCreatedOn());
          }
      }

  - name: error_handling
    prompt: |
      Create a Java example showing proper error handling for document
      analysis operations with HttpResponseException handling.
    expected_patterns:
      - "HttpResponseException"
      - "try"
      - "catch"
      - "getResponse().getStatusCode()"
    tags:
      - error-handling
    mock_response: |
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClient;
      import com.azure.ai.formrecognizer.documentanalysis.DocumentAnalysisClientBuilder;
      import com.azure.core.exception.HttpResponseException;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ErrorHandling {
          public static void main(String[] args) {
              String endpoint = System.getenv("FORM_RECOGNIZER_ENDPOINT");
              
              DocumentAnalysisClient client = new DocumentAnalysisClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              try {
                  client.beginAnalyzeDocumentFromUrl("prebuilt-receipt", "invalid-url");
              } catch (HttpResponseException e) {
                  System.err.println("Status: " + e.getResponse().getStatusCode());
                  System.err.println("Error: " + e.getMessage());
              }
          }
      }
