# Test scenarios for azure-mgmt-fabric-dotnet skill evaluation
# Each scenario tests a specific usage pattern against acceptance criteria

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  # Create Fabric Capacity
  - name: create_fabric_capacity
    prompt: |
      Create a Microsoft Fabric capacity in Azure using the Azure.ResourceManager.Fabric SDK
      with administrators and F64 SKU.
    expected_patterns:
      - "ArmClient"
      - "DefaultAzureCredential"
      - "GetFabricCapacities"
      - "FabricCapacityData"
      - "FabricCapacityProperties"
      - "FabricCapacityAdministration"
      - "FabricSku"
      - "CreateOrUpdateAsync"
    tags:
      - basic
      - capacity
    mock_response: |
      using Azure;
      using Azure.Core;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;
      using Azure.ResourceManager.Fabric.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var administration = new FabricCapacityAdministration(
          new[] { "admin@contoso.com" }
      );

      var properties = new FabricCapacityProperties(administration);

      var sku = new FabricSku("F64", FabricSkuTier.Fabric);

      var capacityData = new FabricCapacityData(
          AzureLocation.WestUS2,
          properties,
          sku)
      {
          Tags = { ["Environment"] = "Production" }
      };

      var capacityCollection = resourceGroup.Value.GetFabricCapacities();
      var operation = await capacityCollection.CreateOrUpdateAsync(
          WaitUntil.Completed,
          "my-fabric-capacity",
          capacityData);

      FabricCapacityResource capacity = operation.Value;
      Console.WriteLine($"Created capacity: {capacity.Data.Name}");
      Console.WriteLine($"State: {capacity.Data.Properties.State}");

  # Get Fabric Capacity
  - name: get_fabric_capacity
    prompt: |
      Retrieve an existing Fabric capacity and display its properties.
    expected_patterns:
      - "GetFabricCapacityAsync"
      - "Properties"
      - "State"
      - "ProvisioningState"
      - "Sku"
    tags:
      - get
      - properties
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var capacity = await resourceGroup.Value
          .GetFabricCapacityAsync("my-fabric-capacity");

      Console.WriteLine($"Name: {capacity.Value.Data.Name}");
      Console.WriteLine($"Location: {capacity.Value.Data.Location}");
      Console.WriteLine($"SKU: {capacity.Value.Data.Sku.Name}");
      Console.WriteLine($"State: {capacity.Value.Data.Properties.State}");
      Console.WriteLine($"Provisioning State: {capacity.Value.Data.Properties.ProvisioningState}");

  # Update Capacity (Scale)
  - name: scale_capacity
    prompt: |
      Scale up a Fabric capacity to a larger SKU and update administrators.
    expected_patterns:
      - "FabricCapacityPatch"
      - "UpdateAsync"
      - "FabricSku"
      - "FabricCapacityAdministration"
    tags:
      - update
      - scale
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;
      using Azure.ResourceManager.Fabric.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var capacity = await resourceGroup.Value
          .GetFabricCapacityAsync("my-fabric-capacity");

      var patch = new FabricCapacityPatch
      {
          Sku = new FabricSku("F128", FabricSkuTier.Fabric),
          Properties = new FabricCapacityUpdateProperties
          {
              Administration = new FabricCapacityAdministration(
                  new[] { "admin@contoso.com", "newadmin@contoso.com" }
              )
          }
      };

      var updateOperation = await capacity.Value.UpdateAsync(
          WaitUntil.Completed,
          patch);

      Console.WriteLine($"Updated SKU: {updateOperation.Value.Data.Sku.Name}");

  # Suspend and Resume
  - name: suspend_resume_capacity
    prompt: |
      Suspend a Fabric capacity to stop billing and then resume it.
    expected_patterns:
      - "SuspendAsync"
      - "ResumeAsync"
      - "WaitUntil.Completed"
    tags:
      - suspend
      - resume
      - cost
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var capacity = await resourceGroup.Value
          .GetFabricCapacityAsync("my-fabric-capacity");

      // Suspend capacity (stop billing for compute)
      await capacity.Value.SuspendAsync(WaitUntil.Completed);
      Console.WriteLine("Capacity suspended");

      // Resume capacity
      var resumeOperation = await capacity.Value.ResumeAsync(WaitUntil.Completed);
      Console.WriteLine($"Capacity resumed. State: {resumeOperation.Value.Data.Properties.State}");

  # Check Name Availability
  - name: check_name_availability
    prompt: |
      Check if a Fabric capacity name is available before creating.
    expected_patterns:
      - "CheckFabricCapacityNameAvailabilityAsync"
      - "FabricNameAvailabilityContent"
      - "IsNameAvailable"
    tags:
      - name
      - validation
    mock_response: |
      using Azure;
      using Azure.Core;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;
      using Azure.ResourceManager.Fabric.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();

      var checkContent = new FabricNameAvailabilityContent
      {
          Name = "my-new-capacity",
          ResourceType = "Microsoft.Fabric/capacities"
      };

      var result = await subscription.CheckFabricCapacityNameAvailabilityAsync(
          AzureLocation.WestUS2,
          checkContent);

      if (result.Value.IsNameAvailable == true)
      {
          Console.WriteLine("Name is available!");
      }
      else
      {
          Console.WriteLine($"Name unavailable: {result.Value.Reason} - {result.Value.Message}");
      }

  # List Capacities
  - name: list_capacities
    prompt: |
      List all Fabric capacities in a resource group and subscription.
    expected_patterns:
      - "GetFabricCapacities"
      - "await foreach"
      - "GetFabricCapacitiesAsync"
    tags:
      - list
      - management
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      // List in resource group
      await foreach (var cap in resourceGroup.Value.GetFabricCapacities())
      {
          Console.WriteLine($"- {cap.Data.Name} ({cap.Data.Sku.Name})");
      }

      // List in subscription
      await foreach (var cap in subscription.GetFabricCapacitiesAsync())
      {
          Console.WriteLine($"- {cap.Data.Name} in {cap.Data.Location}");
      }

  # List Available SKUs
  - name: list_skus
    prompt: |
      List available Fabric SKUs in a subscription.
    expected_patterns:
      - "GetSkusFabricCapacitiesAsync"
      - "await foreach"
      - "Locations"
    tags:
      - sku
      - availability
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();

      // List all SKUs available in subscription
      await foreach (var skuDetails in subscription.GetSkusFabricCapacitiesAsync())
      {
          Console.WriteLine($"SKU: {skuDetails.Name}");
          Console.WriteLine($"  Resource Type: {skuDetails.ResourceType}");
          foreach (var location in skuDetails.Locations)
          {
              Console.WriteLine($"  Location: {location}");
          }
      }

  # Delete Capacity
  - name: delete_capacity
    prompt: |
      Delete a Fabric capacity from Azure.
    expected_patterns:
      - "DeleteAsync"
      - "WaitUntil.Completed"
    tags:
      - delete
      - cleanup
    mock_response: |
      using Azure;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      var subscription = await armClient.GetDefaultSubscriptionAsync();
      var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

      var capacity = await resourceGroup.Value
          .GetFabricCapacityAsync("my-fabric-capacity");

      await capacity.Value.DeleteAsync(WaitUntil.Completed);
      Console.WriteLine("Capacity deleted");

  # Error Handling
  - name: error_handling
    prompt: |
      Implement proper error handling for Fabric capacity operations.
    expected_patterns:
      - "RequestFailedException"
      - "ex.Status"
      - "catch"
      - "when"
    tags:
      - error-handling
      - best-practice
    mock_response: |
      using Azure;
      using Azure.Core;
      using Azure.Identity;
      using Azure.ResourceManager;
      using Azure.ResourceManager.Fabric;
      using Azure.ResourceManager.Fabric.Models;

      var credential = new DefaultAzureCredential();
      var armClient = new ArmClient(credential);

      try
      {
          var subscription = await armClient.GetDefaultSubscriptionAsync();
          var resourceGroup = await subscription.GetResourceGroupAsync("my-resource-group");

          var administration = new FabricCapacityAdministration(new[] { "admin@contoso.com" });
          var properties = new FabricCapacityProperties(administration);
          var sku = new FabricSku("F64", FabricSkuTier.Fabric);
          var capacityData = new FabricCapacityData(AzureLocation.WestUS2, properties, sku);

          var capacityCollection = resourceGroup.Value.GetFabricCapacities();
          var operation = await capacityCollection.CreateOrUpdateAsync(
              WaitUntil.Completed, "my-capacity", capacityData);
      }
      catch (RequestFailedException ex) when (ex.Status == 409)
      {
          Console.WriteLine("Capacity already exists or conflict");
      }
      catch (RequestFailedException ex) when (ex.Status == 400)
      {
          Console.WriteLine($"Invalid configuration: {ex.Message}");
      }
      catch (RequestFailedException ex) when (ex.Status == 403)
      {
          Console.WriteLine("Insufficient permissions or quota exceeded");
      }
      catch (RequestFailedException ex)
      {
          Console.WriteLine($"ARM Error: {ex.Status} - {ex.ErrorCode}: {ex.Message}");
      }
